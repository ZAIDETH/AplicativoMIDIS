<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="static/css/home.css">
        <link rel="stylesheet" href="static/css/btns-control.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
        <link rel="stylesheet" href="https://unpkg.com/leaflet-sidebar-v2/css/leaflet-sidebar.min.css"/>
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #infoSidebar {
        width: 350px;  /* Ancho del sidebar */
        height: auto;  /* Ajusta la altura autom√°ticamente seg√∫n el contenido */
        max-height: 30%;  /* Limita la altura m√°xima del sidebar (porcentaje de la altura total de la ventana) */
        position: fixed;  /* Lo coloca de manera fija en la pantalla */
        top: 10%;  /* Deja un peque√±o margen en la parte superior */
        left: -300px;  /* Inicialmente oculto */
        background-color: rgba(255, 255, 255, 0.9);
        padding: 10px;
        z-index: 999;  /* Aseg√∫rate de que est√© sobre otros elementos */
        box-shadow: 2px 0 2px rgba(0, 0, 0, 0.3);  /* Sombra para dar efecto flotante */
        transition: left 0.3s ease-in-out;  /* Transici√≥n suave */
        overflow-y: auto;  /* Si el contenido es largo, agrega barra de desplazamiento */
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif, sans-serif;  /* Cambi√© la fuente a Arial */
        font-size: 10px;  /* Tama√±o de fuente m√°s peque√±o */
        text-align: justify;  /* Justificar el texto dentro del sidebar */
        color: #bd0606ff;  /* Color gris para el texto */
        border-radius: 15px;  /* Bordes suaves */
        overflow: hidden;  /* Ocultar el desbordamiento fuera del contenedor */
        }
        /* Justificar el texto dentro de la tabla de estratificaci√≥n */
        #infoSidebar table {
            width: 100%;
            border-collapse: collapse;
            text-align: justify;  /* Justificar el texto dentro de la tabla */
            border-radius: 10px;  /* Bordes suaves para la tabla */
        }
        /* Estilo para el encabezado del visor */
        .visor-header {
            width: 100%;
            background: #bd0606ff;
            color: #fff;
            padding: 10px 0;
            text-align: left;
            font-size: 20px;
            position: left;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            letter-spacing: 1px;
            font-weight: bold;
            z-index: 1200;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,.1);
            justify-content: flex-start; /* fuerza alineaci√≥n a la izquierda */
        }
        /* Ajuste para la lista de capas dentro del sidebar */
        #layers-content .leaflet-control-layers {
            width: 100% !important;
            background: transparent !important;
            box-shadow: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            
        }
        #layers-content .leaflet-control-layers-list {
            max-height: auto    ;
            max-width: auto;
            overflow-y: auto;
            width: 100% !important;
        }
        #layers-content .leaflet-control-layers-base,
        #layers-content .leaflet-control-layers-overlays {
            margin-bottom: 10px;
        }
        /* Opcional: mejora visual de los items de la lista */
        #layers-content label {
            font-size: 12px;
            color: #333;
            display: block;
            left: 0%;
        }
        #infoSidebar th, #infoSidebar td {
            padding: 5px;
            text-align: left;  /* Asegura que los textos en las celdas est√©n alineados a la izquierda */
        }

        #infoSidebar td {
            color: #808080;  /* Color gris para las celdas */
        }
        /* Estilo de la caja de desplazamiento, asegurando que el borde se mantenga redondeado */
        #infoSidebar::-webkit-scrollbar {
            width: 8px;
        }

        #infoSidebar::-webkit-scrollbar-thumb {
            background-color: rgba(84, 82, 82, 0.3); /* Color de la barra de desplazamiento */
            border-radius: 10px;  /* Bordes suaves en la barra de desplazamiento */
        }

        #infoSidebar::-webkit-scrollbar-track {
            background-color: #f1f1f1;  /* Color de fondo de la pista */
            border-radius: 10px;  /* Bordes suaves en la pista de desplazamiento */
        }
        
        /* CSS de estilo para el encabezado y el control */
        .visor-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-left: 0;
        }
        .visor-header .logo {
            margin-left: 0;
            margin-right: 12px;
        }
        .leaflet-control-layers-bar {
            display: flex;
            justify-content: space-between;
            background-color: #bd0606ff;
            padding: 8px;
            border-bottom: 1px solid #ccc;
            font-weight: bold;
            font-size: 14px;
            color: white;
        }

        .leaflet-control-layers-toggle {
            background-color: transparent;
            border: none;
            color: white;
            cursor: pointer;
        }

        .leaflet-control-layers-toggle:hover {
            background-color: rgba(255, 255, 255, 0.0);
            color: #fcfdfd;
            
        }
        /* Barra superior tipo toolbar */
        .top-toolbar{
            position:absolute; right:12px; top:12px; z-index:1000;
            background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.2);
            display:flex; gap:6px; padding:6px;
        }
        .top-toolbar button{
            width:36px; height:36px; border:0; background:#f5f5f5; border-radius:8px; cursor:pointer;
            display:flex; align-items:center; justify-content:center; font-size:18px;
            position: right: 10px; top: 10px;
        }
        .top-toolbar button:hover{background:#e9e9e9}

        /* Sidebar pegado dentro del mapa, a la derecha, ocupando alto completo */
        #sidebar.leaflet-sidebar {
        position: absolute !important;
        top: 0;               /* arranca en el borde superior del #map */
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1500;        /* por encima del mapa y controles */
        width: 350px;         /* opcional: tu ancho */
        }

        /* Asegura que el contenido del panel haga scroll si crece
        #sidebar .leaflet-sidebar-content {
        height: 100%;
        overflow: auto;
        } */

        /* Ocultar pesta√±as nativas del sidebar: usaremos botones en el header */
        #sidebar .leaflet-sidebar-tabs { 
        display: none !important;  }
        /* Altura fija del header */
:root{ --h-header: 64px; } /* ajusta 64px a tu gusto */

/* Header fijo arriba */
.visor-header{
  position: fixed;
  top: 0; left: 0; right: 0;
  height: var(--h-header);
  z-index: 2000;
  background:#bd0606ff; color:#fff;
  display:flex; align-items:center; gap:12px; padding:0 12px;
}

/* El mapa ocupa el resto de la pantalla, debajo del header */
html, body { height: 100%; margin: 0; }
#map{
  position: absolute;
  top: var(--h-header);
  left: 0; right: 0; bottom: 0;
}

/* Sidebar dentro del mapa */
#sidebar.leaflet-sidebar{
  position: absolute !important;
  top: 0 !important;   /* el propio #map ya est√° bajo el header */
  right: 0; bottom: 0; left: auto;
  width: 350px;
  transition: right .25s ease;
  z-index: 1500;
}
/* Oculto al iniciar (nada de ‚Äúcaja blanca‚Äù) */

/* Logo alineado a la izquierda en el header */
.visor-header .logo {
    height: 40px;
    margin-right: 16px;
    margin-left: 0;
    display: inline-block;
    vertical-align: middle;
    float: left;
}
#sidebar.leaflet-sidebar.collapsed{
  right: -350px;
  pointer-events: none;
}

/* Controles Leaflet en su sitio por defecto */

/* Asegura que el cursor sea pointer en el icono de cerrar del sidebar */
#sidebar .leaflet-sidebar-close {
    cursor: pointer;
}

/* Mejora la interacci√≥n: resalta el icono al pasar el mouse */
#sidebar .leaflet-sidebar-close:hover {
    background: rgba(0,0,0,0.07);
    border-radius: 4px;
}
.leaflet-top { margin-top: 12px; }
.leaflet-left { margin-left: 12px; }
#btnPrintContainer {
    position: absolute;
    top: 70px; /* Coloca el bot√≥n debajo del header de 64px de altura */
    left: 20px;
    z-index: 1000;
}

#btnPrint {
    background-color: white; /* Sin fondo */
    border: 2px; ; /* Sin borde */
    border-color: #808080;
    border-radius: 2px;
    box-shadow: #808080 0px 2px 4px; /* Sombra para dar efecto flotante */
    color: #000; /* Color negro para el √≠cono */
    font-size: 20px; /* Tama√±o adecuado para el √≠cono */
    cursor: pointer; /* Cambiar el cursor cuando pasa por encima */
    padding: 20; /* Sin padding para que solo se vea el √≠cono */
}

#btnPrint:hover {
    color: #bd0606ff; /* Cambio de color al pasar el mouse */
}

    </style>
    <title></title>
    </head>
    <body>
    <div class="visor-header" id="visor-header"></div>
    <div id="map">
    </div>
    <div id="sidebar" class="leaflet-sidebar leaflet-sidebar-right collapsed">
    <div class="leaflet-sidebar-tabs leaflet-sidebar-tabs-right"> 
        <ul role="tablist" style="float: right;">
        <li><a href="#legend" role="tab" title="Leyenda" id="sidebar-tab-legend"><i class="fa fa-list"></i></a></li>
        <li><a href="#layers" role="tab" title="Capas" id="sidebar-tab-layers"><i class="fa fa-layer-group"></i></a></li>
        <li><a href="#basemaps" role="tab" title="Mapa base" id="sidebar-tab-basemaps"><i class="fa fa-map"></i></a></li>
        <li><a href="#" class="leaflet-sidebar-close"><i class="fa fa-times"></i></a></li>
        </ul>
    </div>
    <style>
    .leaflet-sidebar-tabs-right {
        right: 0;
        left: auto;
    }
    .leaflet-sidebar-tabs-right ul {
        float: left;
    }
    /* Asegurar que el contenido del sidebar haga scroll si es alto */
    #sidebar .leaflet-sidebar-content { 
    height: 80%; 
    width: auto;
    /* overflow: auto; */

    }

    /* (Opcional) oculta la "top-toolbar" flotante si a√∫n existe */
    .top-toolbar { display: none !important; }

    /* Estilos simples para los √≠conos del header */
    .vh-actions { 
    margin-left: auto; 
    display: flex; 
    gap: 8px; 
    align-items: center; 
    }
    .vh-icon {
    background: rgba(255,255,255,0.15);
    border: 0; 
    padding: 6px 8px; 
    border-radius: 6px; 
    cursor: pointer;
    color: #fff; 
    font-size: 14px; 
    }
    .vh-icon:hover { background: rgba(255,255,255,0.25); }
/* Empuja todos los controles superiores por debajo del header rojo */
.leaflet-top { 
    margin-top: calc(var(--h-header) + 12px); /* Empuja los controles debajo del header fijo */
    left: 0 !important;
    right: auto !important;
    position: top !important;
    pointer-events: auto;
}

/* Alineaci√≥n y separaci√≥n vertical est√°ndar */
.leaflet-top .leaflet-control {
  clear: both;        /* que apilen en columna */
  margin-bottom: 8px; /* separaci√≥n entre controles */
  position: top !important;
}

/* margen izquierdo ‚Äúbonito‚Äù */
.leaflet-left { 
  margin-left: 10px; 
}

/* Aseg√∫rate de NO forzar el zoom a bottom-left en ning√∫n sitio */
.leaflet-control-zoom{
    top: auto;
    bottom: auto;
    left: auto;
}

/* --- Cierre de sidebar al hacer click fuera o en la X --- */
#sidebar .leaflet-sidebar-close {
    cursor: pointer;
}
.leaflet-control-attribution {
    text-align: right !important;
    position: right: 10px !important;
}

        </style>
        <div class="leaflet-sidebar-content">
            <div class="leaflet-sidebar-pane" id="legend">
            <h1 class="leaflet-sidebar-header">Leyenda<span class="leaflet-sidebar-close"></span></h1>
            <div id="legend-content">‚Ä¶tu leyenda aqu√≠‚Ä¶</div>
            </div>
            <div class="leaflet-sidebar-pane" id="layers">
            <h1 class="leaflet-sidebar-header">Capas<span class="leaflet-sidebar-close"></span></h1>
            <div id="layers-content"></div>
            </div>
            <div class="leaflet-sidebar-pane" id="basemaps">
            <h1 class="leaflet-sidebar-header">Mapas base<span class="leaflet-sidebar-close"></span></h1>
            <div id="basemap-content"></div>
            </div>
        </div>
        </div>

        <!-- Toolbar superior con 3 botones -->
        <div class="top-toolbar">
        <button id="btnLegend" title="Leyenda">üßæ</button>
        <button id="btnLayers" title="Capas">üóÇÔ∏è</button>
        <button id="btnBasemaps" title="Mapa base">üó∫Ô∏è</button>
        </div>
        <div id="btnPrintContainer">
            <button id="btnPrint" title="Imprimir Mapa">
                <i class="fa fa-print"></i> <!-- √çcono de impresi√≥n -->
            </button>
        </div>
        <script src="static/js/custom.js"></script>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="data/Programassociales_2.js"></script>
        <script src="data/EscenariodePobrezaExtremaPer_3.js"></script>
        <script src="data/EscenariodePobrezaExtremaLima_4.js"></script>
        <script src="data/ProgramaPCAComedoresgeorreferenciados_5.js"></script>
        <script src="data/Departamentos_6.js"></script>
        <script src="data/Provincias_7.js"></script>
        <script src="data/Distritos_8.js"></script>
        <script src="https://unpkg.com/leaflet-sidebar-v2/js/leaflet-sidebar.min.js"></script>
        <script src="https://unpkg.com/leaflet-providers@1.13.0/leaflet-providers.min.js"></script>
        <script src="https://unpkg.com/esri-leaflet@3.0.12/dist/esri-leaflet.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
            highlightLayer.openPopup();
        }

        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:5
        }).fitBounds([[-18.792526138955395,-89.94475065216048],[0.4272491007973172,-60.03575894076365]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'end'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var zoomControl = L.control.zoom({
            position: 'topleft'
            
        }).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);

        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        
        // Sidebar
        const sidebar = L.control.sidebar({ container: 'sidebar', autopan: true, closeButton: true }).addTo(map);
        sidebar.close(); // arranca cerrado
        // a√±ade esta l√≠nea:
        window.sidebarRef = sidebar;
        // Botones que abren pesta√±as
        document.getElementById('btnLegend').onclick = () => { sidebar.open('legend'); };
        document.getElementById('btnLayers').onclick = () => { sidebar.open('layers'); };
        document.getElementById('btnBasemaps').onclick = () => { sidebar.open('basemaps'); };

        // Cerrar sidebar al hacer click en el icono de cerrar
        document.querySelectorAll('.leaflet-sidebar-close').forEach(function(el) {
            el.addEventListener('click', function(e) {
                e.preventDefault();
                sidebar.close();
            });
        });

        map.createPane('pane_OpenStreetMap_0');
        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
        var layer_OpenStreetMap_0 = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
        });
        layer_OpenStreetMap_0;
        map.createPane('pane_Satellite_1');
        map.getPane('pane_Satellite_1').style.zIndex = 401;
        var layer_Satellite_1 = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            pane: 'pane_Satellite_1',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
        });
        layer_Satellite_1;
        map.addLayer(layer_Satellite_1);

        // botones del panel ‚ÄúMapa base‚Äù
        const baseMapsObj = {
        'OpenStreetMap': layer_OpenStreetMap_0,
        'Esri Imagery': layer_Satellite_1,
        };

        (function renderBasemapButtons() {
            const baseDiv = document.getElementById('basemap-content');
            Object.entries(baseMapsObj).forEach(([name, layer]) => {
            const b = document.createElement('button');
            b.textContent = name;
            b.style.margin = '4px';
            b.onclick = () => {
                Object.values(baseMapsObj).forEach(l => map.removeLayer(l));
                layer.addTo(map);
            };
            baseDiv.appendChild(b);
            });
        })();
        function pop_Programassociales_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">UBIGEO</th>\
                        <td>' + (feature.properties['UBIGEO'] !== null ? autolinker.link(String(feature.properties['UBIGEO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">DEPARTAMENTO</th>\
                        <td>' + (feature.properties['DEPARTAMENTO'] !== null ? autolinker.link(String(feature.properties['DEPARTAMENTO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PROVINCIA</th>\
                        <td>' + (feature.properties['PROVINCIA'] !== null ? autolinker.link(String(feature.properties['PROVINCIA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">DISTRITO</th>\
                        <td>' + (feature.properties['DISTRITO'] !== null ? autolinker.link(String(feature.properties['DISTRITO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Periodo</th>\
                        <td>' + (feature.properties['Periodo'] !== null ? autolinker.link(String(feature.properties['Periodo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">CUNAMAS</th>\
                        <td>' + (feature.properties['CUNAMAS'] !== null ? autolinker.link(String(feature.properties['CUNAMAS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">JUNTOS</th>\
                        <td>' + (feature.properties['JUNTOS'] !== null ? autolinker.link(String(feature.properties['JUNTOS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">FONCODES</th>\
                        <td>' + (feature.properties['FONCODES'] !== null ? autolinker.link(String(feature.properties['FONCODES']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PENSION65</th>\
                        <td>' + (feature.properties['PENSION65'] !== null ? autolinker.link(String(feature.properties['PENSION65']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">QALIWARMA</th>\
                        <td>' + (feature.properties['QALIWARMA'] !== null ? autolinker.link(String(feature.properties['QALIWARMA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PAIS</th>\
                        <td>' + (feature.properties['PAIS'] !== null ? autolinker.link(String(feature.properties['PAIS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">CONTIGO</th>\
                        <td>' + (feature.properties['CONTIGO'] !== null ? autolinker.link(String(feature.properties['CONTIGO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PCA</th>\
                        <td>' + (feature.properties['PCA'] !== null ? autolinker.link(String(feature.properties['PCA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PCA</th>\
                        <td colspan="2"><strong>Programas MIDIS</strong><br />' + (feature.properties['Programas_MIDIS'] !== null ? autolinker.link(String(feature.properties['Programas_MIDIS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Programassociales_2_0(feature) {
            switch(String(feature.properties['Programas_MIDIS'])) {
                case '02 programas y/o prestaciones':
                    return {
                pane: 'pane_Programassociales_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(192,255,0,0.9)',
                interactive: true,
            }
                    break;
                case '03 programas y/o prestaciones':
                    return {
                pane: 'pane_Programassociales_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(172,232,7,0.9)',
                interactive: true,
            }
                    break;
                case '04 programas y/o prestaciones':
                    return {
                pane: 'pane_Programassociales_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(151,209,13,0.9)',
                interactive: true,
            }
                    break;
                case '05 programas y/o prestaciones':
                    return {
                pane: 'pane_Programassociales_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(131,186,20,0.9)',
                interactive: true,
            }
                    break;
                case '06 programas y/o prestaciones':
                    return {
                pane: 'pane_Programassociales_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(110,162,27,0.9)',
                interactive: true,
            }
                    break;
                case '07 programas y/o prestaciones':
                    return {
                pane: 'pane_Programassociales_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(90,139,33,0.9)',
                interactive: true,
            }
                    break;
                case '08 programas y/o prestaciones':
                    return {
                pane: 'pane_Programassociales_2',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(69,116,40,0.9)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Programassociales_2');
        map.getPane('pane_Programassociales_2').style.zIndex = 402;
        map.getPane('pane_Programassociales_2').style['mix-blend-mode'] = 'normal';
        var layer_Programassociales_2 = new L.geoJson(json_Programassociales_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Programassociales_2',
            layerName: 'layer_Programassociales_2',
            pane: 'pane_Programassociales_2',
            onEachFeature: pop_Programassociales_2,
            style: style_Programassociales_2_0,
        });
        bounds_group.addLayer(layer_Programassociales_2);
        function pop_EscenariodePobrezaExtremaPer_3(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">ESCENARIO DE POBREZA EXTREMA</th>\
                        <td colspan="2"><strong>gridcode</strong><br />' + (feature.properties['gridcode'] !== null ? autolinker.link(String(feature.properties['gridcode']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">UBIGEO</th>\
                        <td>' + (feature.properties['UBIGEO'] !== null ? autolinker.link(String(feature.properties['UBIGEO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">DEPARTAMENTO</th>\
                        <td>' + (feature.properties['DEPARTAMENTO'] !== null ? autolinker.link(String(feature.properties['DEPARTAMENTO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PROVINCIA</th>\
                        <td>' + (feature.properties['PROVINCIA'] !== null ? autolinker.link(String(feature.properties['PROVINCIA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">DISTRITO</th>\
                        <td>' + (feature.properties['DISTRITO'] !== null ? autolinker.link(String(feature.properties['DISTRITO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">√ÅREA KM2</th>\
                        <td>' + (feature.properties['AREAKM2'] !== null ? autolinker.link(String(feature.properties['AREAKM2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_EscenariodePobrezaExtremaPer_3_0(feature) {
            switch(String(feature.properties['gridcode'])) {
                case '1':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaPer_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(137,205,102,0.8)',
                interactive: true,
            }
                    break;
                case '2':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaPer_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,0,0.8)',
                interactive: true,
            }
                    break;
                case '3':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaPer_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,170,0,0.8)',
                interactive: true,
            }
                    break;
                case '4':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaPer_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,0,0,0.8)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_EscenariodePobrezaExtremaPer_3');
        map.getPane('pane_EscenariodePobrezaExtremaPer_3').style.zIndex = 403;
        map.getPane('pane_EscenariodePobrezaExtremaPer_3').style['mix-blend-mode'] = 'normal';
        var layer_EscenariodePobrezaExtremaPer_3 = new L.geoJson(json_EscenariodePobrezaExtremaPer_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_EscenariodePobrezaExtremaPer_3',
            layerName: 'layer_EscenariodePobrezaExtremaPer_3',
            pane: 'pane_EscenariodePobrezaExtremaPer_3',
            onEachFeature: pop_EscenariodePobrezaExtremaPer_3,
            style: style_EscenariodePobrezaExtremaPer_3_0,
        });
        bounds_group.addLayer(layer_EscenariodePobrezaExtremaPer_3);
        map.addLayer(layer_EscenariodePobrezaExtremaPer_3);
        function pop_EscenariodePobrezaExtremaLima_4(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            // Diccionario de equivalencias
                const gridLabels = {
                    1: "Escenario Pobreza Extrema Baja",
                    2: "Escenario Pobreza Extrema Media",
                    3: "Escenario Pobreza Extrema Alta",
                    4: "Escenario Pobreza Extrema Muy Alta"
                };

                var gridValue = feature.properties['gridcode'];
                var gridText = gridLabels[gridValue] || gridValue;  // si no existe en el diccionario, muestra el n√∫mero

                var popupContent = '<table>\
                    <tr>\
                        <td class="visible-with-data" id="gridcode" colspan="2"><strong>Escenario</strong><br />' 
                            + (gridText !== null ? autolinker.link(String(gridText).replace(/'/g, '\'').toLocaleString()) : '') 
                        + '</td>\
                    </tr>\
                    <tr>\
                        <td class="visible-with-data" id="gridcode" colspan="2"><strong>gridcode</strong><br />' + (feature.properties['gridcode'] !== null ? autolinker.link(String(feature.properties['gridcode']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">UBIGEO</th>\
                        <td>' + (feature.properties['UBIGEO'] !== null ? autolinker.link(String(feature.properties['UBIGEO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">DEPARTAMENTO</th>\
                        <td>' + (feature.properties['DEPARTAMENTO'] !== null ? autolinker.link(String(feature.properties['DEPARTAMENTO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">PROVINCIA</th>\
                        <td>' + (feature.properties['PROVINCIA'] !== null ? autolinker.link(String(feature.properties['PROVINCIA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">DISTRITO</th>\
                        <td>' + (feature.properties['DISTRITO'] !== null ? autolinker.link(String(feature.properties['DISTRITO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">√ÅREA KM2</th>\
                        <td colspan="2">' + (feature.properties['AREAKM2'] !== null ? autolinker.link(String(feature.properties['AREAKM2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_EscenariodePobrezaExtremaLima_4_0(feature) {
            switch(String(feature.properties['gridcode'])) {
                case '1':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaLima_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(137,205,102,0.8)',
                interactive: true,
            }
                    break;
                case '2':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaLima_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,0,0.8)',
                interactive: true,
            }
                    break;
                case '3':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaLima_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,170,0,0.8)',
                interactive: true,
            }
                    break;
                case '4':
                    return {
                pane: 'pane_EscenariodePobrezaExtremaLima_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,0,0,0.8)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_EscenariodePobrezaExtremaLima_4');
        map.getPane('pane_EscenariodePobrezaExtremaLima_4').style.zIndex = 404;
        map.getPane('pane_EscenariodePobrezaExtremaLima_4').style['mix-blend-mode'] = 'normal';
        var layer_EscenariodePobrezaExtremaLima_4 = new L.geoJson(json_EscenariodePobrezaExtremaLima_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_EscenariodePobrezaExtremaLima_4',
            layerName: 'layer_EscenariodePobrezaExtremaLima_4',
            pane: 'pane_EscenariodePobrezaExtremaLima_4',
            onEachFeature: pop_EscenariodePobrezaExtremaLima_4,
            style: style_EscenariodePobrezaExtremaLima_4_0,
        });
        bounds_group.addLayer(layer_EscenariodePobrezaExtremaLima_4);
        map.addLayer(layer_EscenariodePobrezaExtremaLima_4);
        function pop_ProgramaPCAComedoresgeorreferenciados_5(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Semestre</th>\
                        <td>' + (feature.properties['Semestre'] !== null ? autolinker.link(String(feature.properties['Semestre']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Fuente</th>\
                        <td>' + (feature.properties['De_Fuente'] !== null ? autolinker.link(String(feature.properties['De_Fuente']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Departamento</th>\
                        <td>' + (feature.properties['Departamento'] !== null ? autolinker.link(String(feature.properties['Departamento']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Provincia</th>\
                        <td>' + (feature.properties['Provincia'] !== null ? autolinker.link(String(feature.properties['Provincia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Distrito</th>\
                        <td>' + (feature.properties['Distrito'] !== null ? autolinker.link(String(feature.properties['Distrito']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Centro Atenci√≥n</th>\
                        <td>' + (feature.properties['Nombre_Centro_Atencion'] !== null ? autolinker.link(String(feature.properties['Nombre_Centro_Atencion']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Direcci√≥n Centro Atenci√≥n</th>\
                        <td>' + (feature.properties['Direccion_Centro_Atencion'] !== null ? autolinker.link(String(feature.properties['Direccion_Centro_Atencion']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">CORTE</th>\
                        <td>' + (feature.properties['CORTE'] !== null ? autolinker.link(String(feature.properties['CORTE']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Ubigeo</th>\
                        <td>' + (feature.properties['Ubigeo'] !== null ? autolinker.link(String(feature.properties['Ubigeo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Codigo CA</th>\
                        <td>' + (feature.properties['CodigoCA'] !== null ? autolinker.link(String(feature.properties['CodigoCA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Total de Usuarios</th>\
                        <td>' + (feature.properties['Total_Usuarios'] !== null ? autolinker.link(String(feature.properties['Total_Usuarios']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Mujeres</th>\
                        <td>' + (feature.properties['Sexo_Femenino'] !== null ? autolinker.link(String(feature.properties['Sexo_Femenino']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Hombres</th>\
                        <td>' + (feature.properties['Sexo_Masculino'] !== null ? autolinker.link(String(feature.properties['Sexo_Masculino']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sin Dato</th>\
                        <td>' + (feature.properties['SinDato_Sexo'] !== null ? autolinker.link(String(feature.properties['SinDato_Sexo']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Edad Sin Dato</th>\
                        <td>' + (feature.properties['Edad_SinDato'] !== null ? autolinker.link(String(feature.properties['Edad_SinDato']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Edad 0 a 11</th>\
                        <td>' + (feature.properties['Edad_0_11'] !== null ? autolinker.link(String(feature.properties['Edad_0_11']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Edad 11 a 18</th>\
                        <td>' + (feature.properties['Edad_11_18'] !== null ? autolinker.link(String(feature.properties['Edad_11_18']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Edad 18 a 26</th>\
                        <td>' + (feature.properties['Edad_18_26'] !== null ? autolinker.link(String(feature.properties['Edad_18_26']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Edad 26 a 59</th>\
                        <td>' + (feature.properties['Edad_26_59'] !== null ? autolinker.link(String(feature.properties['Edad_26_59']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Edad 59 a 95</th>\
                        <td>' + (feature.properties['Edad_59_95'] !== null ? autolinker.link(String(feature.properties['Edad_59_95']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Edad 95+</th>\
                        <td>' + (feature.properties['Edad_95_mas'] !== null ? autolinker.link(String(feature.properties['Edad_95_mas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_ProgramaPCAComedoresgeorreferenciados_5_0() {
            return {
                pane: 'pane_ProgramaPCAComedoresgeorreferenciados_5',
                radius: 2.4,
                opacity: 1,
                color: 'rgba(185,49,250,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(148,238,215,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_ProgramaPCAComedoresgeorreferenciados_5');
        map.getPane('pane_ProgramaPCAComedoresgeorreferenciados_5').style.zIndex = 405;
        map.getPane('pane_ProgramaPCAComedoresgeorreferenciados_5').style['mix-blend-mode'] = 'normal';
        var layer_ProgramaPCAComedoresgeorreferenciados_5 = new L.geoJson(json_ProgramaPCAComedoresgeorreferenciados_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_ProgramaPCAComedoresgeorreferenciados_5',
            layerName: 'layer_ProgramaPCAComedoresgeorreferenciados_5',
            pane: 'pane_ProgramaPCAComedoresgeorreferenciados_5',
            onEachFeature: pop_ProgramaPCAComedoresgeorreferenciados_5,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_ProgramaPCAComedoresgeorreferenciados_5_0(feature));
            },
        });
        bounds_group.addLayer(layer_ProgramaPCAComedoresgeorreferenciados_5);
        function pop_Departamentos_6(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">DEPARTAMEN</th>\
                        <td>' + (feature.properties['DEPARTAMEN'] !== null ? autolinker.link(String(feature.properties['DEPARTAMEN']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">CAPITAL</th>\
                        <td>' + (feature.properties['CAPITAL'] !== null ? autolinker.link(String(feature.properties['CAPITAL']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Departamentos_6_0() {
            return {
                pane: 'pane_Departamentos_6',
                opacity: 1,
                color: 'rgba(255,255,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: false,
            }
        }
        map.createPane('pane_Departamentos_6');
        map.getPane('pane_Departamentos_6').style.zIndex = 406;
        map.getPane('pane_Departamentos_6').style['mix-blend-mode'] = 'normal';
        var layer_Departamentos_6 = new L.geoJson(json_Departamentos_6, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Departamentos_6',
            layerName: 'layer_Departamentos_6',
            pane: 'pane_Departamentos_6',
            onEachFeature: pop_Departamentos_6,
            style: style_Departamentos_6_0,
        });
        bounds_group.addLayer(layer_Departamentos_6);
        map.addLayer(layer_Departamentos_6);
        function pop_Provincias_7(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Departamento</th>\
                        <td>' + (feature.properties['DEPARTAMEN'] !== null ? autolinker.link(String(feature.properties['DEPARTAMEN']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">C√≥digo Provincia</th>\
                        <td>' + (feature.properties['CODPROV'] !== null ? autolinker.link(String(feature.properties['CODPROV']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Provincia</th>\
                        <td class="visible-with-data" id="PROVINCIA">' + (feature.properties['PROVINCIA'] !== null ? autolinker.link(String(feature.properties['PROVINCIA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Provincias_7_0() {
            return {
                pane: 'pane_Provincias_7',
                opacity: 1,
                color: 'rgba(220,110,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 2.0,
                fillOpacity: 0,
                interactive: false,
            }
        }
        map.createPane('pane_Provincias_7');
        map.getPane('pane_Provincias_7').style.zIndex = 407;
        map.getPane('pane_Provincias_7').style['mix-blend-mode'] = 'normal';
        var layer_Provincias_7 = new L.geoJson(json_Provincias_7, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Provincias_7',
            layerName: 'layer_Provincias_7',
            pane: 'pane_Provincias_7',
            onEachFeature: pop_Provincias_7,
            style: style_Provincias_7_0,
        });
        bounds_group.addLayer(layer_Provincias_7);
        map.addLayer(layer_Provincias_7);
        function pop_Distritos_8(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">UBIGEO</th>\
                        <td class="visible-with-data" id="UBIGEO">' + (feature.properties['UBIGEO'] !== null ? autolinker.link(String(feature.properties['UBIGEO']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Departamento</th>\
                        <td class="visible-with-data" id="NOMBDEP">' + (feature.properties['NOMBDEP'] !== null ? autolinker.link(String(feature.properties['NOMBDEP']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Provincia</th>\
                        <td class="visible-with-data" id="NOMBPROV">' + (feature.properties['NOMBPROV'] !== null ? autolinker.link(String(feature.properties['NOMBPROV']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Distrito</th>\
                        <td class="visible-with-data" id="NOMBDIST">' + (feature.properties['NOMBDIST'] !== null ? autolinker.link(String(feature.properties['NOMBDIST']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Distritos_8_0() {
            return {
                pane: 'pane_Distritos_8',
                opacity: 1,
                color: 'rgba(250,246,49,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 2.0,
                fillOpacity: 0,
                interactive: false,
            }
        }
        map.createPane('pane_Distritos_8');
        map.getPane('pane_Distritos_8').style.zIndex = 408;
        map.getPane('pane_Distritos_8').style['mix-blend-mode'] = 'normal';
        var layer_Distritos_8 = new L.geoJson(json_Distritos_8, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Distritos_8',
            layerName: 'layer_Distritos_8',
            pane: 'pane_Distritos_8',
            onEachFeature: pop_Distritos_8,
            style: style_Distritos_8_0,
        });
        bounds_group.addLayer(layer_Distritos_8);
        map.addLayer(layer_Distritos_8);
        map.on("zoomend", function() {
            // Asegurarse de que la capa de Departamentos siempre est√© visible
            if (!map.hasLayer(layer_Departamentos_6)) {
                map.addLayer(layer_Departamentos_6);  // Asegurarse de que siempre est√© visible
            }

            // Condici√≥n de zoom para Provincias (aparece entre zoom 10 y 14)
            if (map.getZoom() >= 10 && map.getZoom() <= 14) {
                if (!map.hasLayer(layer_Provincias_7)) {
                    map.addLayer(layer_Provincias_7); // Agregar capa de Provincias
                }
            } else {
                if (map.hasLayer(layer_Provincias_7)) {
                    map.removeLayer(layer_Provincias_7); // Eliminar capa de Provincias
                }
            }

            // Condici√≥n de zoom para Distritos (aparece entre zoom 14 y 28)
            if (map.getZoom() >= 14 && map.getZoom() <= 28) {
                if (!map.hasLayer(layer_Distritos_8)) {
                    map.addLayer(layer_Distritos_8); // Agregar capa de Distritos
                }
            } else {
                if (map.hasLayer(layer_Distritos_8)) {
                    map.removeLayer(layer_Distritos_8); // Eliminar capa de Distritos
                }
            }
        });

        // Asegurarse de que las capas no se carguen al inicio si est√°n fuera de su rango de zoom
        if (map.getZoom() < 10 || map.getZoom() > 1) {
            map.removeLayer(layer_Provincias_7); // Eliminar Provincias si no est√° en el rango adecuado
        }
        if (map.getZoom() < 13 || map.getZoom() > 28) {
            map.removeLayer(layer_Distritos_8); // Eliminar Distritos si no est√° en el rango adecuado
        }

        var overlaysTree = [
            {label: '<img src="legend/ProgramaPCAComedoresgeorreferenciados_5.png" /> Programa PCA - Comedores georreferenciados', layer: layer_ProgramaPCAComedoresgeorreferenciados_5},
            {label: 'Escenario de Pobreza Extrema - Lima<br /><table><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaLima_4_Bajo0.png" /></td><td>Bajo</td></tr><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaLima_4_Medio1.png" /></td><td>Medio</td></tr><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaLima_4_Alto2.png" /></td><td>Alto</td></tr><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaLima_4_MuyAlto3.png" /></td><td>Muy Alto</td></tr></table>', layer: layer_EscenariodePobrezaExtremaLima_4},
            {label: 'Escenario de Pobreza Extrema Per√∫<br /><table><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaPer_3_EscenarioPobrezaExtremaBaja0.png" /></td><td>Escenario Pobreza Extrema Baja</td></tr><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaPer_3_EscenarioPobrezaExtremaMedia1.png" /></td><td>Escenario Pobreza Extrema Media</td></tr><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaPer_3_EscenarioPobrezaExtremaAlta2.png" /></td><td>Escenario Pobreza Extrema Alta</td></tr><tr><td style="text-align: center;"><img src="legend/EscenariodePobrezaExtremaPer_3_EscenarioPobrezaExtremaMuyAlta3.png" /></td><td>Escenario Pobreza Extrema Muy Alta</td></tr></table>', layer: layer_EscenariodePobrezaExtremaPer_3},
            {label: 'Programas sociales<br /><table><tr><td style="text-align: center;"><img src="legend/Programassociales_2_02programasyoprestaciones0.png" /></td><td>02 programas y/o prestaciones</td></tr><tr><td style="text-align: center;"><img src="legend/Programassociales_2_03programasyoprestaciones1.png" /></td><td>03 programas y/o prestaciones</td></tr><tr><td style="text-align: center;"><img src="legend/Programassociales_2_04programasyoprestaciones2.png" /></td><td>04 programas y/o prestaciones</td></tr><tr><td style="text-align: center;"><img src="legend/Programassociales_2_05programasyoprestaciones3.png" /></td><td>05 programas y/o prestaciones</td></tr><tr><td style="text-align: center;"><img src="legend/Programassociales_2_06programasyoprestaciones4.png" /></td><td>06 programas y/o prestaciones</td></tr><tr><td style="text-align: center;"><img src="legend/Programassociales_2_07programasyoprestaciones5.png" /></td><td>07 programas y/o prestaciones</td></tr><tr><td style="text-align: center;"><img src="legend/Programassociales_2_08programasyoprestaciones6.png" /></td><td>08 programas y/o prestaciones</td></tr></table>', layer: layer_Programassociales_2},
            {label: '<img src="legend/Distritos_8.png" /> Distritos', layer: layer_Distritos_8},
            {label: '<img src="legend/Provincias_7.png" /> Provincias', layer: layer_Provincias_7},
            {label: '<img src="legend/Departamentos_6.png" /> Departamentos', layer: layer_Departamentos_6},
            {label: "Satellite", layer: layer_Satellite_1, radioGroup: 'bm' },
            {label: "OpenStreetMap", layer: layer_OpenStreetMap_0, radioGroup: 'bm' },]
        
            function renderLegendFromTree(tree) {
            const legendEl = document.getElementById('legend-content');
            const parts = [];

            tree.forEach(node => {
                // Solo overlays (evitar basemaps con radioGroup) y que tengan una tabla de leyenda
                const hasLegendTable = typeof node.label === 'string' && node.label.includes('<table');
                const isBaseMap = 'radioGroup' in node; // los basemaps en tu √°rbol tienen radioGroup:'bm'

                if (!isBaseMap && hasLegendTable) {
                // Envolvemos cada bloque para estilizar si quieres
                parts.push(`<div class="legend-block">${node.label}</div>`);
                }
            });

            legendEl.innerHTML = parts.join('') || '<em>No hay leyendas configuradas.</em>';
            }

            // Llamada para construir la leyenda
            renderLegendFromTree(overlaysTree);

                // 1) Crear e inicializar el control
        var lay = L.control.layers.tree(null, overlaysTree, { collapsed: false }).addTo(map);

        // 2) Tomar el contenedor real del control y moverlo al panel
        const layersContentEl = document.getElementById('layers-content');
        const layContainer   = lay.getContainer();          // <div class="leaflet-control-layers ...">
        if (layersContentEl && layContainer && layContainer.parentNode) {
        // lo sacamos de la esquina del mapa‚Ä¶
        layContainer.parentNode.removeChild(layContainer);
        // ‚Ä¶y lo insertamos en el sidebar
        layersContentEl.innerHTML = '';                   // limpia si recargas
        layersContentEl.appendChild(layContainer);
        }

        // (Opcional) evita que el scroll/click del control afecte al mapa
        L.DomEvent.disableClickPropagation(layContainer);
        L.DomEvent.disableScrollPropagation(layContainer);

                // Inyectar el control en el div #layers-content del sidebar
                // const layersContentEl = document.getElementById('layers-content');                                  
                // layersContentEl.appendChild(lay.onAdd(map));
                document.addEventListener("DOMContentLoaded", function() {
                    // set new Layers List height which considers toggle icon
                    function newLayersListHeight() {
                        var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                        if (layerScrollbarElement) {
                            var layersListElement = document.querySelector('.leaflet-control-layers-list');
                            var originalHeight = layersListElement.style.height 
                                || window.getComputedStyle(layersListElement).height;
                            var newHeight = parseFloat(originalHeight) - 50;
                            layersListElement.style.height = newHeight + 'px';
                        }
                    }
                    // var isLayersListExpanded = true;
                    var controlLayersElement = document.querySelector('.leaflet-control-layers');
                    var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
                    // toggle Collapsed/Expanded and apply new Layers List height
                    toggleLayerControl.addEventListener('click', function() {
                        if (isLayersListExpanded) {
                            controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                        } else {
                            controlLayersElement.classList.add('leaflet-control-layers-expanded');
                        }
                        isLayersListExpanded = !isLayersListExpanded;
                        newLayersListHeight()
                    });	
                    // apply new Layers List height if toggle layerstree
                    if (controlLayersElement) {
                        controlLayersElement.addEventListener('click', function(event) {
                            var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
                            if (toggleLayerHeaderPointer) {
                                newLayersListHeight();
                            }
                        });
                    }
                    // Collapsed/Expanded at Start to apply new height
                    setTimeout(function() {
                        toggleLayerControl.click();
                    }, 10);
                    setTimeout(function() {
                        toggleLayerControl.click();
                    }, 10);
                    // Collapsed touch/small screen
                    var isSmallScreen = window.innerWidth < 650;
                    if (isSmallScreen) {
                        setTimeout(function() {
                            controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                            isLayersListExpanded = !isLayersListExpanded;
                        }, 500);
                    }  
                });       
                setBounds();
                var i = 0;
                layer_Departamentos_6.eachLayer(function(layer) {
                    var context = {
                        feature: layer.feature,
                        variables: {}
                    };
                    // layer.bindTooltip((layer.feature.properties['DEPARTAMEN'] !== null?String('<div style="color: #323232; font-size: 5pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['DEPARTAMEN']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Departamentos_6'});
                    labels.push(layer);
                    totalMarkers += 1;
                    layer.added = true;
                    addLabel(layer, i);
                    i++;
                });
                var i = 0;
                layer_Provincias_7.eachLayer(function(layer) {
                    var context = {
                        feature: layer.feature,
                        variables: {}
                    };
                    layer.bindTooltip((layer.feature.properties['PROVINCIA'] !== null?String('<div style="color: #323232; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['PROVINCIA']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Provincias_7'});
                    labels.push(layer);
                    totalMarkers += 1;
                    layer.added = true;
                    addLabel(layer, i);
                    i++;
                });
                var i = 0;
                layer_Distritos_8.eachLayer(function(layer) {
                    var context = {
                        feature: layer.feature,
                        variables: {}
                    };
                    layer.bindTooltip((layer.feature.properties['NOMBDIST'] !== null?String('<div style="color: #323232; font-size: 10pt; font-weight: bold; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['NOMBDIST']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Distritos_8'});
                    labels.push(layer);
                    totalMarkers += 1;
                    layer.added = true;
                    addLabel(layer, i);
                    i++;
                });
                resetLabels([layer_Departamentos_6,layer_Provincias_7,layer_Distritos_8]);
                map.on("zoomend", function(){
                    resetLabels([layer_Departamentos_6,layer_Provincias_7,layer_Distritos_8]);
                });
                map.on("layeradd", function(){
                    resetLabels([layer_Departamentos_6,layer_Provincias_7,layer_Distritos_8]);
                });
                map.on("layerremove", function(){
                    resetLabels([layer_Departamentos_6,layer_Provincias_7,layer_Distritos_8]);
                });
                </script>
                <script>
                window.addEventListener('load', () => {
                    const mapEl = document.getElementById('map');
                    const sidebarEl = document.getElementById('sidebar');
                    if (mapEl && sidebarEl && sidebarEl.parentNode !== mapEl) {
                    mapEl.appendChild(sidebarEl);   // ahora el sidebar es hijo de #map
                    }
                    mapEl.style.position = 'relative'; // (redundante si ya lo pusiste en CSS)
                });
                </script>
                <script src="static/js/mainMap.js"></script>
                <!-- <script src="static/js/home.js"></script>  -->
                <script>
        // Borra cualquier bot√≥n heredado/inyectado que no quieras
        document.querySelectorAll('.btns-control.leaflet-control, .leaflet-bar.btns-control')
            .forEach(el => el.remove());
        </script>
        <script>
        const HomeControl = L.Control.extend({
            options: { position: 'topleft' },
            onAdd: function() {
            const c = L.DomUtil.create('div','leaflet-bar');
            const a = L.DomUtil.create('a','',c);
            a.href = '#'; a.title = 'Volver a vista inicial';
            a.innerHTML = '<i class="fa fa-home"></i>';
            L.DomEvent.on(a,'click',(e)=>{
                L.DomEvent.preventDefault(e);
                map.setView([-9.2,-75], 5);  // tu vista inicial
            });
            return c;
            }
        });
        map.addControl(new HomeControl());
        </script>
        <script>
        document.querySelectorAll('.btns-control.leaflet-control, .leaflet-bar.btns-control')
            .forEach(el => el.remove());
        </script>
        <script src="static/js/impresion.js"></script>
        <!-- Aqu√≠ est√° el bot√≥n de impresi√≥n justo debajo del visor-header -->
        
    </body>
</html>
